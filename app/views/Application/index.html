#{extends 'main.html' /}
#{set title:'Home' /}

<style>
	${cssStr} { list-style-type: none; margin: 5px 5px 5px 5px; padding: 0; float: auto; }
	${cssStr2} { margin: 5px 5px 5px 5px; padding: 25px; font-size: 1.2em; float: auto; margin-right: auto; margin-left: auto; }
	
.main-area{
   background-color: #E3E3E3;
   border-radius: 6px 6px 6px 6px;
   text-align: center;
   align: center;
 }
 
 .note{
    background: repeat-x scroll 50% 50% #FFFFFF;
    border-radius: 6px 6px 6px 6px;
    color: #1C94C4;
    font-weight: bold;
    outline: medium none;
 }
 
 .hero-unit-myversion {
    background-color: #5E768D;
    border-radius: 6px 6px 6px 6px;
    margin-bottom: 30px;
    padding: 60px;
    float: auto; 
    margin-right: 30px; 
    margin-left: auto;
    
}

.myDiver{
     min-height:50px;
     height:auto !important;
     height:50px; 
}

input {
	height: 45px; padding: 20px 20px 0px 20px; margin: 0px 0px 0px 0px; 
	background: #ffffff;
	background: -moz-linear-gradient(top, #ffffff 0%, #ffffff 20%); /* firefox */
	background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#ffffff), color-stop(20%,#ffffff)); /* webkit */
	border-radius: 5px; -moz-border-radius: 5px; -webkit-border-radius: 5px;
	-moz-box-shadow: 0px 1px 0px #f2f2f2;-webkit-box-shadow: 0px 1px 0px #f2f2f2;
	font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; color: #1C94C4; font-weight:bold; text-align: center;
	float: auto; margin-right: auto; margin-left: auto;
}

input:focus {
	background: #ffffff;
	background: -moz-linear-gradient(top, #ffffff 0%, #ffffff 20%); /* firefox */
	background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#ffffff), color-stop(20%,#ffffff)); /* webkit */
	float: auto; margin-right: auto; margin-left: auto;
}

.placeHolderBG {
 	background: repeat-x scroll 50% 50% #D3D3D3;
 	border-radius: 6px 6px 6px 6px;
 	border: 1px dotted black;
}

.uiEffects {
  -webkit-box-shadow:#333333 0 4px 6px;
  border-radius: 6px 6px 6px 6px;
  background-attachment:initial;
  background-clip:initial;
  background-color:initial;
  background-image:-webkit-linear-gradient(top, #FFFFFF 0%, #FFFFFF 100%);
  background-origin:initial;
  background-position:initial initial;
  background-repeat:initial initial;
  border-top-color:#CCCCCC;
  border-top-style:solid;
  border-top-width:1px;
  box-shadow:#333333 0 4px 6px;
  color:#000000;
  z-index:50001;
}

.topCorner{
 	display:block;
    position:relative;
 	top:-25px;
 	left:20px;
}

.closeMe{
  color:#000000;
  float:right;
  font-size:15px;
  font-weight:bold;
  line-height:15px;
  opacity:0.4;
  text-shadow:#FFFFFF 0 1px 0;
}
</style>

	<script>
	
	$(function() {
		$('a[rel=popover]').popover({
			html:true,
       
		}).click(function(e) {
			$(this).popover('hide');
		})
	})
	
	function appendLINode(node, noteId, title, pos) {
		node.append('<li id="'+noteId+'" positionInRow="'+pos+'" class="note"><a class="topCorner" id="blob" onclick="javascript:deleteMe('+noteId+')" rel="popover" title="Delete Note" data-content="Click here to delete the note!" style="float: right;" href="#"><span class="closeMe">x</span></a><a class="edit'+noteId+'" id="blob1" rel="popover" onclick="javascript:editMe('+noteId+', '+title+')" title="Edit Note" data-content="Click here to edit the note!" href="#">'+title+'</a></li>') 
		$("#blob").popover({offset: 10});
		$("#blob1").popover({offset: 10});
	}
	
	function create( template, vars, opts ){
		return $container.notify("create");
	}
			
	$(function() {
		
		$container = $("#container-bottom").notify({ stack:'above' });
		
		$("${cssStr}").sortable({
	        connectWith: '.connectedSortable',
	        placeholder: "placeHolderBG",
	        start: function(event, ui) {
	        	ui.placeholder.height(ui.item.height());
	            item = ui.item;
	            newList = oldList = ui.item.parent();
	            startIndex =  ui.item.index();
	        },
	        stop: function(event, ui) { 
	        	var noteId = item.attr('id');
	        	updateNotePos(noteId, startIndex, ui.item.index(), oldList.attr('cleanid'), newList.attr('cleanid'));
	        },
	        change: function(event, ui) {  
	            if(ui.sender) newList = ui.placeholder.parent();
	        }   
		});
		$("${cssStr}").disableSelection();
	});
	
	</script>
	
<div id="myModal" class="modal hide fade">
	<div class="modal-header">
		<a class="close" data-dismiss="modal">&times;</a>
		<h3>About</h3>
	</div>
	<div class="modal-body">
		
		<p>Exempel p&aring; vad man kan &aring;stadkomma med HTML5, JQuery, BootStrap, Heroku och Play Framework.</p>
		<ul class="thumbnails">
	 
        <li class="span2">
          <a href="#" class="thumbnail">
            <img src="@{'/public/images/play_logo.png'}" alt="">
          </a>
        </li>
        <li class="span2">
          <a href="#" class="thumbnail">
            <img src="@{'/public/images/jquery_logo.png'}" alt="">
          </a>
        </li>
        
       <li class="span2">
          <a href="#" class="thumbnail">
            <img src="@{'/public/images/heroku_logo.png'}" alt="">
          </a>
        </li>
        <li class="span2">
          <a href="#" class="thumbnail">
            <img src="@{'/public/images/html5_logo.png'}" alt="">
          </a>
        </li>
      </ul>
	</div>
</div>

<div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Kanban Board</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a data-toggle="modal" href="#myModal">About</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

   <!--   <div class="container">-->
   <div>

	<!-- Main hero unit for a primary marketing message or call to action -->
	<div class="hero-unit-myversion">
	<!-- set the container hidden to avoid a flash of unstyled content when the page first loads -->

		<div class="row-fluid">
			<!-- Loop starts here -->
			#{list items:noterows, as:'noterow'}

			<div class="span3 main-area">
				<h2>${noterow.title}</h2>
				<ul id="sortable${noterow.id}" cleanid="${noterow.id}" class="connectedSortable posRow${noterow.id} myDiver">
				
					#{list models.Note.findByNoteRow(noterow), as:'note'}
						<li onmouseover="javascript:borderEffectAdd(${note.id})" onmouseout="javascript:borderEffectRemove(${note.id})" id="${note.id}" positionInRow="${note.positionInRow}" class="note">
						<div class="topCorner"><a onclick="javascript:deleteMe(${note.id})" rel="popover" title="Delete Note" data-content="Click here to delete the note!" style="float: right;" href="#">
						<span class="closeMe"/>x</a></div>
						<a class="edit${note.id}" rel="popover" onclick="javascript:editMe(${note.id}, '${note.title}')" title="Edit Note" data-content="Click here to edit the note!" href="#">${note.title}</a></li> 
					#{/list}
					
				</ul>
							<div id="addToggle${noterow.id}" style="display: none" class="input">
								<input type="text" class="note" name="addnote${noterow.id}"
									id="addnote${noterow.id}" class="xlarge">
									<br/>
									<input type="button" class="btn" id="button${noterow.id}" onClick="javascript:sendIt('${noterow.id}')" value="Add">
					
							</div>
						
				<a id="addNoteToggle${noterow.id}" onclick="javascript:toggleAdd('${noterow.id}')" class="btn" href="#">Add Note</a>
			</div>		
			#{/list}					
		</div>
		<!-- Loop ends here -->
	</div>



	<hr>
	<!-- /container -->

	<script type="text/javascript" charset="utf-8">
	
	function borderEffectAdd(id) {
		document.getElementById(id).setAttribute("class", "uiEffects");
	}
	
	function borderEffectRemove(id) {
		document.getElementById(id).setAttribute("class", "note");
	}

		function deleteMe(noteId) {
			$.post('@{deleteNote()}', {
				noteId : noteId
			}, function() {
				$('li').remove('#'+noteId);
			})
		}
		
		function editMe(noteId, title) {
			
			var newTitlePrompt = prompt('Change title?', title);
			
			if(newTitlePrompt != null && newTitlePrompt != '') {
			
			$.post('@{editNote()}', {
				noteId: noteId,
				newTitle: newTitlePrompt
				}, function(task) {
					if(task.title != null && task.title != '')
						$('a.edit'+noteId).replaceWith(task.title)
				
			}, 'json')
			
			}
		}

		function toggleAdd(str) {
			document.getElementById("addToggle" + str).style.display = "block";
			document.getElementById("addNoteToggle" + str).style.display = "none";
			document.getElementById("addnote" + str).focus();
		}

		function updateNotePos(noteId, startUiIndex, stopUiIndex, fromList,
				toList) {
			$.post('@{updateNotePosition()}', {
				noteId : noteId,
				startUiIndex : startUiIndex,
				stopUiIndex : stopUiIndex,
				fromList : fromList,
				toList : toList
			}, function() {
				var incVal = 0;
					//A list have lost an element lets give it new position values
					if(from != to) {
						$("ul#sortable"+fromList).children('li').each(function(newPos, elm) {  
							  elm.setAttribute("positionInRow", incVal++);
						});
					}
			})
		}

		//Catch enter key!!
		$(function() {
			$("input:text[name*='addnote']").bind("keyup", function(e) {
				if (e.which == '13') {
					var idTmp = this.id;
					idTmp = idTmp.replace("addnote", "");
					sendIt(idTmp);
				}
			});
		});

		function sendIt(str) {
			var tmp = "addnote" + str;
			var tmp2 = ".posRow" + str;
			var tmp3 = "addToggle" + str;
			var tmp4 = "addNoteToggle" + str;
			
			$.post('@{addNewNote()}', {
				id : str,
				title : document.getElementById(tmp).value,
				text : ""
			}, function(jsonNote) {
				appendLINode($(tmp2), jsonNote.id, jsonNote.title, jsonNote.positionInRow);
			
			}, 'json')
			document.getElementById(tmp).value = '';
			document.getElementById(tmp3).style.display = "none";
			document.getElementById(tmp4).style.display = "inline";
			
			
		}
		
		
		
	</script>

<!--- second container -  bottom notifications --->
	<div id="container-bottom" style="top:auto; left:0; bottom:0; margin:0 0 10px 10px;display: none">
		<div>
			<div style="float:left;margin:0 10px 10px 10px"><img src="@{'/public/images/info-icon.png'}" alt="info" /></div>
			<p>INFO!</p>
			<p>Another user is currently updating the board!</p>
		</div>
	</div>